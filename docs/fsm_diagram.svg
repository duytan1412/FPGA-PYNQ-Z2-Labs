<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 440 340" style="max-width: 440px; background: #f8f9fa; border-radius: 8px;">
    <!-- Definitions for markers -->
    <defs>
        <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto"
            markerUnits="strokeWidth">
            <path d="M0,0 L0,6 L9,3 z" fill="#333" />
        </marker>
    </defs>

    <!-- IDLE State (Top Center) -->
    <!-- Center x=220 -->
    <rect x="170" y="20" width="100" height="40" rx="8" fill="#90EE90" stroke="#333" stroke-width="2" />
    <text x="220" y="45" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold">IDLE</text>

    <!-- Arrow IDLE -> ACCUMULATE (Down) -->
    <line x1="220" y1="60" x2="220" y2="80" stroke="#333" stroke-width="2" marker-end="url(#arrow)" />
    <text x="225" y="75" font-family="Arial, sans-serif" font-size="11" fill="#666">coin</text>

    <!-- ACCUMULATE State (Below IDLE) -->
    <rect x="160" y="85" width="120" height="40" rx="8" fill="#87CEEB" stroke="#333" stroke-width="2" />
    <text x="220" y="110" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold">ACCUMULATE</text>

    <!-- Self loop 'more coins' (Right Side) -->
    <!-- Adjusted control points for a cleaner loop -->
    <path d="M 280 95 C 330 75, 330 135, 280 115" fill="none" stroke="#333" stroke-width="1.5"
        stroke-dasharray="4" marker-end="url(#arrow)" />
    <text x="335" y="105" font-family="Arial, sans-serif" font-size="10" fill="#666">more coins</text>

    <!-- Arrow ACCUMULATE -> SELECT (Down) -->
    <line x1="220" y1="125" x2="220" y2="145" stroke="#333" stroke-width="2" marker-end="url(#arrow)" />
    <text x="225" y="140" font-family="Arial, sans-serif" font-size="11" fill="#666">item_sel</text>

    <!-- Arrow ACCUMULATE -> CHANGE (Cancel) - LEFT ROUTE -->
    <!-- WIDER ROUTE: x=10 to avoid sticking to other blocks -->
    <path d="M 160 105 L 10 105 L 10 305 L 170 305" fill="none" stroke="#333" stroke-width="1.5"
        marker-end="url(#arrow)" />
    <!-- Text moved closer to the vertical line -->
    <text x="15" y="200" font-family="Arial, sans-serif" font-size="11" fill="#666" transform="rotate(-90 15 200)">cancel</text>

    <!-- SELECT State (Below Accumulate) -->
    <rect x="170" y="150" width="100" height="40" rx="8" fill="#FFD700" stroke="#333" stroke-width="2" />
    <text x="220" y="175" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold">SELECT</text>

    <!-- Arrow SELECT -> DISPENSE (Left Down) -->
    <line x1="190" y1="190" x2="120" y2="220" stroke="#333" stroke-width="2" marker-end="url(#arrow)" />
    <!-- Adjusted text position -->
    <text x="105" y="200" text-anchor="end" font-family="Arial, sans-serif" font-size="10" fill="#666">balâ‰¥price</text>

    <!-- Arrow SELECT -> ERROR (Right Down) -->
    <line x1="250" y1="190" x2="320" y2="220" stroke="#333" stroke-width="2" marker-end="url(#arrow)" />
    <!-- Adjusted text position -->
    <text x="335" y="200" text-anchor="start" font-family="Arial, sans-serif" font-size="10" fill="#666">bal&lt;price</text>

    <!-- DISPENSE State (Left Bottom) -->
    <rect x="60" y="225" width="100" height="40" rx="8" fill="#98FB98" stroke="#333" stroke-width="2" />
    <text x="110" y="250" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold">DISPENSE</text>

    <!-- ERROR State (Right Bottom) -->
    <rect x="280" y="225" width="100" height="40" rx="8" fill="#FF6B6B" stroke="#333" stroke-width="2" />
    <text x="330" y="250" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold">ERROR</text>

    <!-- Arrow DISPENSE -> CHANGE (Down Right) -->
    <line x1="110" y1="265" x2="190" y2="285" stroke="#333" stroke-width="2" marker-end="url(#arrow)" />

    <!-- Arrow ERROR -> CHANGE (Down Left) -->
    <line x1="330" y1="265" x2="250" y2="285" stroke="#333" stroke-width="2" marker-end="url(#arrow)" />

    <!-- CHANGE State (Bottom Center) -->
    <rect x="170" y="285" width="100" height="40" rx="8" fill="#FFA500" stroke="#333" stroke-width="2" />
    <text x="220" y="310" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold">CHANGE</text>

    <!-- Arrow CHANGE -> IDLE (Loop Back - Right Side) -->
    <!-- WIDER ROUTE: x=430 to avoid Error block -->
    <path d="M 270 305 L 430 305 L 430 40 L 270 40" fill="none" stroke="#333" stroke-width="2"
        marker-end="url(#arrow)" />

</svg>
